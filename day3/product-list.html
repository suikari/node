<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/vue@3"></script>

</head>
<body>
    

    <div id="app">

        <div class="col-auto">
            <select v-model="pageSize" class="form-select board-select" @change="fnList">
                <option value="5">5Í∞úÏî©</option>
                <option value="10">10Í∞úÏî©</option>
                <option value="15">15Í∞úÏî©</option>
                <option value="20">20Í∞úÏî©</option>
            </select>
        </div>

        <!-- Í≤ÄÏÉâ ÏòµÏÖò -->
        <div class="col-auto">
            <select v-model="searchOption" class="form-select">
                <option value="all">Ï†ÑÏ≤¥</option>
                <option value="productName">ÏÉÅÌíàÎ™Ö</option>
                <option value="category">Ïπ¥ÌÖåÍ≥†Î¶¨</option>
            </select>
        </div>
    
        <!-- Í≤ÄÏÉâÏñ¥ ÏûÖÎ†• -->
        <div class="col">
            <input v-model="keyword" @keyup.enter="fnBoardSearch" class="form-control board-search" placeholder=" üîçÍ≤ÄÏÉâÏñ¥ ÏûÖÎ†•" />
        </div>
    
        <!-- Í≤ÄÏÉâ Î≤ÑÌäº -->
        <div class="col-auto">
            <button class="btn btn-primary board-search-btn" @click="fnBoardSearch">Í≤ÄÏÉâ</button>
        </div>

        <table >
            <tr>
                <th>ÏÑ†ÌÉù</th>
                <th>Î≤àÌò∏</th>
                <th>ÏÉÅÌíàÎ™Ö</th>
                <th>Í∏àÏï°</th>
                <th>Ïπ¥ÌÖåÍ≥†Î¶¨</th>
            </tr>
            
            <template v-for="item in list">
                <tr >
                    <td><input type="radio" name="productId" v-model="deleteNo" :value="item.productId"></td>
                    <td>{{item.productId}}</td>
                    <td><a href="javascript:;" @click="fnView(item.productId)">{{item.productName}}</a></td>
                    <td>{{item.price}}</td>
                    <td>{{item.category}}</td>
                </tr>   
            </template>

        </table>

        <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≤ÑÌäº -->
        <div>
            <!-- Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
            <a class="btn btn-outline-secondary board-page-btn prev-next-btn" href="javascript:;" @click="fnPageMove('prev')" v-if="page != 1">
                <i class="bi bi-chevron-left"><</i>
            </a>
    
            <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ -->
            <template v-for="num in index">
                <!-- Ï≤´ Î≤àÏß∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÎäî "..." -->
                    <a v-if="num === 1 && page > 3" 
                        href="javascript:;"  
                        @click="fnPage(1)" 
                        class="btn btn-outline-secondary board-page-btn">
                        ...
                    </a>
                
                    <!-- ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Í∏∞Ï§Ä Ï¢åÏö∞ 2Í∞úÏî© ÌëúÏãú -->
                    <a v-if="num >= page - 2 && num <= page + 2" 
                        href="javascript:;"  
                        @click="fnPage(num)" 
                        class="btn btn-outline-secondary board-page-btn" 
                        :class="{ 'active': page === num }">
                        {{ num }}
                    </a>
                
                    <a v-if="num === index && page < index - 2" 
                        href="javascript:;"  
                        @click="fnPage(index)" 
                        class="btn btn-outline-secondary board-page-btn">
                        ...
                    </a>
            </template>
    
            <!-- Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
            <a class="btn btn-outline-secondary board-page-btn prev-next-btn" href="javascript:;" @click="fnPageMove('next')" v-if="index > 0 && page != index">
                <i class="bi bi-chevron-right">></i>
            </a>
        </div>

        <button @click="fnAdd">ÏÉùÏÑ±</button>
        <button @click="fnDelete">ÏÇ≠Ï†ú</button>



    </div>


</body>
</html>


<script>
    
    const app = Vue.createApp({
                data() {
                    return {
                        list : [],
                        view : [],
                        selectNO : -1,
                        deleteNo : "",
                        index : 0 ,
                        page: 1,
	                    pageSize: 5,
                        searchOption : 'all',
                        keyword : '',
                    };
                },
                computed: {

                },
                methods: {
                    fnView (productId) {
                        location.href = 'product-view.html?productId='+ productId;
                        
                    }, 
                    fnList () {
                        offset = (this.page -1) * this.pageSize; 
                        
                        fetch('http://localhost:3000/product?offset='+offset+'&limit='+ this.pageSize + '&keyword=' + this.keyword)
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);
                                this.index = Math.ceil(data.cnt / this.pageSize);
                                this.list = data.list;  
                            });
                    },
                    fnDelete() {

                        if(!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌï†Í±∞?')){
                            return;
                        } 

                        fetch('http://localhost:3000/product', {
                            method : "DELETE",
                            headers : {
                                "Content-type" : "application/json",
                            },
                            body : JSON.stringify({ productId : this.deleteNo}),
                        })
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);
                                this.fnList();
                            })
                            .catch( err => {
                                console.log("ÏÑúÎ≤Ñ ÏóêÎü¨");
                            });

                        
                    },
                    fnAdd () {
                        location.href = 'product-add.html';
                    },
                    fnPage(num) {
                        this.page = num;
                        this.fnList();
                    },
                    fnPageMove(direction) {
                        if (direction === "next") this.page++;
                        else this.page--;
                        this.fnList();
                    },
                    fnBoardSearch : function(){
                        let self = this;
                        self.page = 1;
                        self.fnList();
                    },
                },
                mounted() {
                    this.fnList();
                	
                }
            });

            app.mount("#app");



</script>