<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/vue@3"></script>

</head>
<body>
    

    <div id="app">

        <div class="col-auto">
            <select v-model="pageSize" class="form-select board-select" @change="fnList">
                <option value="5">5ê°œì”©</option>
                <option value="10">10ê°œì”©</option>
                <option value="15">15ê°œì”©</option>
                <option value="20">20ê°œì”©</option>
            </select>
        </div>

        <!-- ê²€ìƒ‰ ì˜µì…˜ -->
        <div class="col-auto">
            <select v-model="searchOption" class="form-select">
                <option value="all">ì „ì²´</option>
                <option value="productName">ìƒí’ˆëª…</option>
                <option value="category">ì¹´í…Œê³ ë¦¬</option>
            </select>
        </div>
    
        <!-- ê²€ìƒ‰ì–´ ì…ë ¥ -->
        <div class="col">
            <input v-model="keyword" @keyup.enter="fnBoardSearch" class="form-control board-search" placeholder=" ğŸ”ê²€ìƒ‰ì–´ ì…ë ¥" />
        </div>
    
        <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
        <div class="col-auto">
            <button class="btn btn-primary board-search-btn" @click="fnBoardSearch">ê²€ìƒ‰</button>
        </div>

        <table >
            <tr>
                <th>ì„ íƒ</th>
                <th>ë²ˆí˜¸</th>
                <th>ìƒí’ˆëª…</th>
                <th>ê¸ˆì•¡</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
            </tr>
            
            <template v-for="item in list">
                <tr >
                    <td><input type="radio" name="productId" v-model="deleteNo" :value="item.productId"></td>
                    <td>{{item.productId}}</td>
                    <td><a href="javascript:;" @click="fnView(item.productId)">{{item.productName}}</a></td>
                    <td>{{item.price}}</td>
                    <td>{{item.category}}</td>
                </tr>   
            </template>

        </table>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
        <div>
            <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
            <a class="btn btn-outline-secondary board-page-btn prev-next-btn" href="javascript:;" @click="fnPageMove('prev')" v-if="page != 1">
                <i class="bi bi-chevron-left"><</i>
            </a>
    
            <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
            <template v-for="num in index">
                <!-- ì²« ë²ˆì§¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” "..." -->
                    <a v-if="num === 1 && page > 3" 
                        href="javascript:;"  
                        @click="fnPage(1)" 
                        class="btn btn-outline-secondary board-page-btn">
                        ...
                    </a>
                
                    <!-- í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ ì¢Œìš° 2ê°œì”© í‘œì‹œ -->
                    <a v-if="num >= page - 2 && num <= page + 2" 
                        href="javascript:;"  
                        @click="fnPage(num)" 
                        class="btn btn-outline-secondary board-page-btn" 
                        :class="{ 'active': page === num }">
                        {{ num }}
                    </a>
                
                    <a v-if="num === index && page < index - 2" 
                        href="javascript:;"  
                        @click="fnPage(index)" 
                        class="btn btn-outline-secondary board-page-btn">
                        ...
                    </a>
            </template>
    
            <!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
            <a class="btn btn-outline-secondary board-page-btn prev-next-btn" href="javascript:;" @click="fnPageMove('next')" v-if="index > 0 && page != index">
                <i class="bi bi-chevron-right">></i>
            </a>
        </div>

        <button @click="fnAdd">ìƒì„±</button>
        <button v-if="userStatus=='A'" @click="fnDelete">ì‚­ì œ</button>


        <button @click="fnLogout">ë¡œê·¸ì•„ì›ƒ</button>

    </div>


</body>
</html>


<script>
    
    const app = Vue.createApp({
                data() {
                    return {
                        list : [],
                        view : [],
                        selectNO : -1,
                        deleteNo : "",
                        index : 0 ,
                        page: 1,
	                    pageSize: 5,
                        searchOption : 'all',
                        keyword : '',
                        userStatus : '',
                    };
                },
                computed: {

                },
                methods: {
                    fnView (productId) {
                        location.href = 'product-view.html?productId='+ productId;
                        
                    }, 
                    fnList () {
                        offset = (this.page -1) * this.pageSize; 
                        
                        fetch('http://localhost:3000/product?offset='+offset+'&limit='+ this.pageSize + '&keyword=' + this.keyword)
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);
                                this.index = Math.ceil(data.cnt / this.pageSize);
                                this.list = data.list;  
                            });
                    },
                    fnDelete() {

                        if(!confirm('ì •ë§ ì‚­ì œí• ê±°?')){
                            return;
                        } 

                        fetch('http://localhost:3000/product', {
                            method : "DELETE",
                            headers : {
                                "Content-type" : "application/json",
                            },
                            body : JSON.stringify({ productId : this.deleteNo}),
                        })
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);
                                this.fnList();
                            })
                            .catch( err => {
                                console.log("ì„œë²„ ì—ëŸ¬");
                            });

                        
                    },
                    fnAdd () {
                        location.href = 'product-add.html';
                    },
                    fnPage(num) {
                        this.page = num;
                        this.fnList();
                    },
                    fnPageMove(direction) {
                        if (direction === "next") this.page++;
                        else this.page--;
                        this.fnList();
                    },
                    fnBoardSearch : function(){
                        let self = this;
                        self.page = 1;
                        self.fnList();
                    },
                    fnUser (){
                        
                        let self = this;

                        fetch('http://localhost:3000/login/info',{
                            method : "GET",
                            credentials : "include",
                            headers: {
                                "Content-Type": "application/json"
                                // Authorization í—¤ë”ëŠ” í•„ìš” ì—†ìŒ! (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì•ˆ ì“°ê³  ìˆìœ¼ë‹ˆê¹Œ)
                            }
                        })
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);
                                if(!data.isLogin) {
                                    alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.');
                                    //location.href = '/day4/login.html';
                                } else {
                                    this.fnList();
                                    this.userStatus = data.user.sessionStatus;
                                }
                                
                            });

                    },
                    fnLogout (){
                        let self = this;
                        fetch('http://localhost:3000/user/logout',{
                            method : "GET",
                            credentials : "include"
                        })
                            .then((res)=> res.json())
                            .then((data) => {
                                console.log(data);    
                                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                location.href = '/day4/login.html';
          
                            });

                    }
                },
                mounted() {
                	this.fnUser();
                }
            });

            app.mount("#app");



</script>